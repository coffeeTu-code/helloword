> 图片来源：[简书]()



# 优秀程序员的代码都是如何分层的？



[TOC]



## 背景


说起应用分层，大部分人都会认为这个不是很简单嘛 就controller，service, mapper三层。

看起来简单，很多人其实并没有把他们职责划分开，在很多代码中，controller做的逻辑比service还多,service往往当成透传了，这其实是很多人开发代码都没有注意到的地方，反正功能也能用，至于放哪无所谓呗。这样往往造成后面代码无法复用，层级关系混乱，对后续代码的维护非常麻烦。

的确在这些人眼中分层只是一个形式，前辈们的代码这么写的，其他项目代码这么写的，那么我也这么跟着写。但是在真正的团队开发中每个人的习惯都不同，写出来的代码必然带着自己的标签，有的人习惯controller写大量的业务逻辑，有的人习惯在service中之间调用远程服务，这样就导致了每个人的开发代码风格完全不同，后续其他人修改的时候，一看，我靠这个人写的代码和我平常的习惯完全不同，修改的时候到底是按着自己以前的习惯改，还是跟着前辈们走，这又是个艰难的选择，选择一旦有偏差，你的后辈又维护你的代码的时候，恐怕就要骂人了。

所以一个好的应用分层需要具备以下几点:
1. 方便后续代码进行维护扩展；
2. 分层的效果需要让整个团队都接受；
3. 各个层职责边界清晰。


## 如何进行分层

在阿里的编码规范中约束的分层如下:

![阿里的编码规范中约束的分层.jpeg](https://upload-images.jianshu.io/upload_images/14738618-157b7d24a566161f.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


### 2.1 终端显示层  
  各个端的模板渲染并执行显示的层。当前主要是 velocity 渲染，JS 渲染， JSP 渲染，移动端展示等。


### 2.2 开放接口层  
  可直接封装 Service 方法暴露成 RPC 接口;通过 Web 封装成 http 接口;进行 网关安全控制、流量控制等。


### 2.3 Web 层  
  主要是对访问控制进行转发，各类基本参数校验，或者不复用的业务简单处理等。


### 2.4 Service 层  
  相对具体的业务逻辑服务层。


### 2.5 Manager 层  
  通用业务处理层，它有如下特征:
  1. 对第三方平台封装的层，预处理返回结果及转化异常信息；
  2. 对Service层通用能力的下沉，如缓存方案、中间件通用处理;
  3. 与DAO层交互，对多个DAO的组合复用。


### 2.6 DAO 层  
  数据访问层，与底层 MySQL、Oracle、Hbase 进行数据交互。


## 分层领域模型的转换

在阿里巴巴编码规约中列举了下面几个领域模型规约:

![领域模型.jpeg](https://upload-images.jianshu.io/upload_images/14738618-b3a5fe05fc8c0ec5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


- Query：数据查询对象，各层接收上层的查询请求。注意超过2个参数的查询封装，禁止使用Map类来传输。
- VO（View Object）：显示层对象，通常是Web向模板渲染引擎层传输的对象。
- DTO（Data Transfer Object）：数据传输对象，Service或Manager向外传输的对象。
- AO（Application Object）：应用对象。在Web层与Service层之间抽象的复用对象模型，极为贴近展示层，复用度不高。
- BO（Business Object）：业务对象。由Service层输出的封装业务逻辑的对象。
- DO（Data Object）：与数据库表结构一一对应，通过DAO层向上传输数据源对象。


